// Generated by CoffeeScript 1.3.3
(function() {

  angular.module('ipic.directives', []);

  angular.module('ipic', ['ipic.directives']).value('ipic.config', {});

  angular.module('ipic.directives').directive('ipic', function() {
    var definition;
    definition = {
      restrict: 'E',
      replace: false,
      template: "<img/>",
      link: function(scope, element, attrs) {
        var modelName, onUploadComplete, options;
        scope._element = element;
        modelName = attrs['model'];
        $(element).removeAttr('model');
        onUploadComplete = function($element, result) {
          var resultObject;
          console.log("on Upload complete..");
          resultObject = $.parseJSON(result);
          scope.$apply(function() {
            return scope.imageUrl = resultObject.url;
          });
          console.log("scope url :: " + scope.imageUrl);
          return null;
        };
        options = {
          onUploadComplete: onUploadComplete
        };
        scope.$watch(modelName, function(newValue, oldValue, scope) {
          if (!(scope.imageChanger != null)) {
            $(element).attr('src', newValue);
            return scope.imageChanger = new com.ee.InplaceImageChanger(element, options);
          } else {
            return scope.imageChanger.updateImageSrc(newValue);
          }
        }, true);
        return null;
      }
    };
    return definition;
  });

}).call(this);
