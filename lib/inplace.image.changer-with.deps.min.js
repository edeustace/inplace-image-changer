if(!XMLHttpRequest.prototype.sendAsBinary){XMLHttpRequest.prototype.sendAsBinary=function(b){var c,d,a;c=function(e){return e.charCodeAt(0)&255};d=Array.prototype.map.call(b,c);a=new Uint8Array(d);this.send(a.buffer);return null}}window.com||(window.com={});com.ee||(com.ee={});this.com.ee.InplaceImageChanger=(function(){function a(d,c){var b;this.$element=$(d);b={maxFileSizeInKB:400};if(c!=null){this.options=$.extend(b,c)}else{this.options=b}console.log("maxfile size: "+this.options.maxFileSizeInKB);this._createImageTag(this.$element.attr("data-original-content"));this._createFileInput()}a.prototype.uploadCompleted=function(b,d){var f,c,e;e=$.parseJSON(d);f=this.$element.attr("data-custom-response-key");c=f!=null?f:"url";this._createImageTag(e[c]);this._createFileInput();if(this.options.uploadCompleted!=null){return this.options.uploadCompleted(b,d)}};a.prototype._createImageTag=function(c){var b;var d=this;b="<img style='cursor:pointer' src='"+c+"'/>";this.$element.html(b);this.$element.find("img").click(function(e){return d.$element.find("input").trigger("click")});return null};a.prototype._createFileInput=function(){var b;var c=this;b='<input \n       style="visibility: hidden; width: 1px; height: 1px;" \n       type="file" \n       name="'+(this.$element.attr("data-form-name"))+'">\n</input>';this.$element.append(b);this.$element.find("input").change(function(d){return c._handleFileSelect(d)});return null};a.prototype._handleFileSelect=function(c){var e,d,b;var g=this;console.log("_handleFileSelect");d=c.target.files;e=c.target.files[0];b=new FileReader();b.onloadend=function(f){return g._onLocalFileLoadEnd(f,e)};b.readAsBinaryString(e);return null};a.prototype._onLocalFileLoadEnd=function(c,e){var h,b,d,f;var g=this;if(e.size>this.options.maxFileSizeInKB*1024){if(this.options.onLocalFileTooBig!=null){this.options.onLocalFileTooBig(e.size,this.options.maxFileSizeInKB)}return}console.log("_onLocalFileLoadEnd");d=new Date().getTime();h="------multipartformboundary"+d;f=new XMLHttpRequest();f.open("POST",this.$element.attr("data-url"),true);f.setRequestHeader("content-type","multipart/form-data; boundary="+h);f.setRequestHeader("Accept","application/json");b=this._buildMultipartFormBody(e,c.target.result,h);f.sendAsBinary(b);f.onload=function(){return g.uploadCompleted(g.$element,f.responseText)};return null};a.prototype._buildMultipartFormBody=function(c,d,g){var f,b,e;b=new com.ee.MultipartFormBuilder(g);e=this.options.data;f=[{file:c,data:d,paramName:this.$element.attr("data-form-name")}];return b.buildMultipartFormBody(e,f,g)};return a})();jQuery.fn.inplaceImageChanger=function(a){this.each(function(b){if(!jQuery(this).data("com_ee_inplaceImageChanger")){return jQuery(this).data("com_ee_inplaceImageChanger",new com.ee.InplaceImageChanger(this,a))}});return this};window.com||(window.com={});com.ee||(com.ee={});this.com.ee.MultipartFormBuilder=(function(){function a(b){this.boundary=b;this.dashdash="--";this.crlf="\r\n"}a.prototype.buildMultipartFormBody=function(c,e){var b;var d=this;b="";if(c!=null){$.each(c,function(f,g){if((typeof g)==="function"){g=g()}return b+=d.buildFormSegment(f,g)})}if(e!=null){$.each(e,function(f,g){b+=d.buildFileFormSegment(g.paramName,g.file,g.data);return null})}b+=this.dashdash;b+=this.boundary;b+=this.dashdash;b+=this.crlf;return b};a.prototype.buildFormSegment=function(c,d){var b;b=this._buildContentDisposition(c);return this._buildFormSegment(b,d)};a.prototype._buildContentDisposition=function(b){var c;c='Content-Disposition: form-data; name="${name}" ';return c.replace("${name}",b)};a.prototype._buildFileContentDisposition=function(c,d){var b;this.template='Content-Disposition: form-data; name="${formName}"; filename="${fileName}" ';b=this.template.replace("${formName}",c);b=b.replace("${fileName}",d);return b};a.prototype.buildFileFormSegment=function(e,d,c){var b;b=this._buildFileContentDisposition(e,d.name);b+=this.crlf;b+="Content-Type: "+d.type;return this._buildFormSegment(b,c)};a.prototype._buildFormSegment=function(b,d){var c;c="";c+=this.dashdash;c+=this.boundary;c+=this.crlf;c+=b;c+=this.crlf;c+=this.crlf;c+=d;c+=this.crlf;return c};return a})();