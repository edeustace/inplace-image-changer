if(!XMLHttpRequest.prototype.sendAsBinary){XMLHttpRequest.prototype.sendAsBinary=function(b){var c,d,a;c=function(e){return e.charCodeAt(0)&255};d=Array.prototype.map.call(b,c);a=new Uint8Array(d);this.send(a.buffer);return null}}window.com||(window.com={});com.ee||(com.ee={});this.com.ee.InplaceImageChanger=(function(){function a(e,c){var b,d;var f=this;d=function(){};b={maxFileSizeInKB:2000,onProgressUpdate:d,onLoadStart:d,onLocalFileTooBig:d,onUploadComplete:function(h,g){return f.onUploadComplete(h,g)}};if(c!=null){this.options=$.extend(b,c)}else{this.options=b}this.$element=$("<span></span>");this.$element.insertAfter($(e));this._copyAttributes($(e),this.$element);$(e).remove();this._createImageTag(this.$element.attr("href"));this._createFileInput()}a.prototype._copyAttributes=function(e,f){var b,c,d;c=e[0].attributes;for(d in c){b=c[d];if(!(b.name!=null)||!(b.nodeValue!=null)){continue}console.log(""+b.name+" : "+b.nodeValue);f.attr(b.name,b.nodeValue)}return null};a.prototype._createImageTag=function(c){var b;var d=this;b="<img style='cursor:pointer' src='"+c+"'/>";this.$element.html(b);this.$element.find("img").click(function(e){return d.$element.find("input").trigger("click")});return null};a.prototype._createFileInput=function(){var b;var c=this;b='<input \n       style="visibility: hidden; width: 1px; height: 1px;" \n       type="file" \n       name="'+(this.$element.attr("form-name"))+'">\n</input>';this.$element.append(b);this.$element.find("input").change(function(d){return c._handleFileSelect(d)});return null};a.prototype._handleFileSelect=function(c){var d,b;var e=this;d=c.target.files;this.file=c.target.files[0];b=new FileReader();b.onloadend=function(f){return e._onLocalFileLoadEnd(f)};b.readAsBinaryString(this.file);return null};a.prototype._onLocalFileLoadEnd=function(c){var g,b,d,e;var f=this;if(this.file.size>this.options.maxFileSizeInKB*1024){if(this.options.onLocalFileTooBig!=null){this.options.onLocalFileTooBig(this.file.size,this.options.maxFileSizeInKB)}return}d=new Date().getTime();g="------multipartformboundary"+d;b=this._buildMultipartFormBody(this.file,c.target.result,g);e=new XMLHttpRequest();e.upload.index=0;e.upload.file=this.file;e.upload.downloadStartTime=d;e.upload.currentStart=d;e.upload.currentProgress=0;e.upload.startData=0;e.upload.addEventListener("progress",(function(h){return f._progress(h)}),false);e.open("POST",this.$element.attr("form-url"),true);e.setRequestHeader("content-type","multipart/form-data; boundary="+g);e.setRequestHeader("Accept","application/json");e.sendAsBinary(b);this.options.onLoadStart(this.$element);e.onload=function(){return f.options.onUploadComplete(f.$element,e.responseText)};return null};a.prototype._buildMultipartFormBody=function(c,d,g){var f,b,e;b=new com.ee.MultipartFormBuilder(g);e=this.options.data;f=[{file:c,data:d,paramName:this.$element.attr("form-name")}];return b.buildMultipartFormBody(e,f,g)};a.prototype._progress=function(c){var b;if(!c.lengthComputable){return}b=Math.round((c.loaded*100)/c.total);if(this.currentProgress===b){return}this.currentProgress=b;this.options.onProgressUpdate(this.$element,this.file,this.currentProgress);return null};a.prototype.onUploadComplete=function(b,d){var f,c,e;e=$.parseJSON(d);f=this.$element.attr("custom-response-key");c=f!=null?f:"url";this._createImageTag(e[c]);this._createFileInput();return null};return a})();jQuery.fn.inplaceImageChanger=function(a){this.each(function(b){if(!jQuery(this).data("com_ee_inplaceImageChanger")){return jQuery(this).data("com_ee_inplaceImageChanger",new com.ee.InplaceImageChanger(this,a))}});return this};window.com||(window.com={});com.ee||(com.ee={});this.com.ee.MultipartFormBuilder=(function(){function a(b){this.boundary=b;this.dashdash="--";this.crlf="\r\n"}a.prototype.buildMultipartFormBody=function(c,e){var b;var d=this;b="";if(c!=null){$.each(c,function(f,g){if((typeof g)==="function"){g=g()}return b+=d.buildFormSegment(f,g)})}if(e!=null){$.each(e,function(f,g){b+=d.buildFileFormSegment(g.paramName,g.file,g.data);return null})}b+=this.dashdash;b+=this.boundary;b+=this.dashdash;b+=this.crlf;return b};a.prototype.buildFormSegment=function(c,d){var b;b=this._buildContentDisposition(c);return this._buildFormSegment(b,d)};a.prototype._buildContentDisposition=function(b){var c;c='Content-Disposition: form-data; name="${name}" ';return c.replace("${name}",b)};a.prototype._buildFileContentDisposition=function(c,d){var b;this.template='Content-Disposition: form-data; name="${formName}"; filename="${fileName}" ';b=this.template.replace("${formName}",c);b=b.replace("${fileName}",d);return b};a.prototype.buildFileFormSegment=function(e,d,c){var b;b=this._buildFileContentDisposition(e,d.name);b+=this.crlf;b+="Content-Type: "+d.type;return this._buildFormSegment(b,c)};a.prototype._buildFormSegment=function(b,d){var c;c="";c+=this.dashdash;c+=this.boundary;c+=this.crlf;c+=b;c+=this.crlf;c+=this.crlf;c+=d;c+=this.crlf;return c};return a})();